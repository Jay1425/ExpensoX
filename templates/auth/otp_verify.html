<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OTP Verification - ExpensoX</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'neon-cyan': '#00ffff',
                        'neon-purple': '#bf00ff',
                        'neon-pink': '#ff1493',
                        'neon-green': '#39ff14',
                        'dark-bg': '#0a0a0a',
                        'dark-card': '#1a1a1a',
                    },
                    animation: {
                        'glow-pulse': 'glow-pulse 2s ease-in-out infinite alternate',
                        'float': 'float 3s ease-in-out infinite',
                        'neon-flicker': 'neon-flicker 1.5s infinite alternate',
                    },
                    boxShadow: {
                        'neon-pink': '0 0 10px #ff1493, 0 0 20px #ff1493',
                        'neon-purple': '0 0 10px #bf00ff, 0 0 20px #bf00ff',
                    }
                }
            }
        }
    </script>
    <style>
        @keyframes glow-pulse {
            from { text-shadow: 0 0 5px #ff1493, 0 0 10px #ff1493; }
            to { text-shadow: 0 0 10px #ff1493, 0 0 15px #ff1493; }
        }
        
        @keyframes float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-20px); }
        }
        
        @keyframes neon-flicker {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.8; }
        }
        
        .neon-text {
            text-shadow: 0 0 5px currentColor, 0 0 10px currentColor;
        }
        
        .form-container {
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 20, 147, 0.2);
            transition: all 0.3s ease;
        }
        
        .form-container:hover {
            border-color: rgba(255, 20, 147, 0.4);
            box-shadow: 0 0 20px rgba(255, 20, 147, 0.1);
        }
        
        .otp-input {
            background: rgba(26, 26, 26, 0.8);
            border: 1px solid rgba(255, 255, 255, 0.1);
            transition: all 0.3s ease;
            text-align: center;
            font-size: 1.5rem;
            font-weight: bold;
            width: 50px;
            height: 50px;
        }
        
        .otp-input:focus {
            border-color: #ff1493;
            box-shadow: 0 0 10px rgba(255, 20, 147, 0.3);
            outline: none;
        }
        
        .btn-neon {
            position: relative;
            overflow: hidden;
            transition: all 0.3s ease;
        }
        
        .btn-neon::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            transition: left 0.5s;
        }
        
        .btn-neon:hover::before {
            left: 100%;
        }
        
        .bg-gradient-neon {
            background: radial-gradient(ellipse at center, rgba(255, 20, 147, 0.1) 0%, rgba(191, 0, 255, 0.1) 35%, rgba(0, 255, 255, 0.1) 70%, rgba(10, 10, 10, 1) 100%);
        }
        
        .pulse-ring {
            animation: pulse-ring 1.5s infinite;
        }
        
        @keyframes pulse-ring {
            0% {
                transform: scale(0.33);
                opacity: 1;
            }
            80%, 100% {
                transform: scale(1);
                opacity: 0;
            }
        }
        
        @media (max-width: 768px) {
            .otp-input {
                width: 40px;
                height: 40px;
                font-size: 1.2rem;
            }
        }
    </style>
</head>
<body class="bg-dark-bg text-white min-h-screen bg-gradient-neon">
    <div class="min-h-screen flex items-center justify-center px-4">
        <div class="w-full max-w-md">
            <div class="text-center mb-8">
                <h1 class="text-4xl font-bold text-neon-cyan neon-text animate-neon-flicker">ExpensoX</h1>
                <p class="text-gray-400 mt-2">The Future of Expense Management</p>
            </div>
            
            <div class="form-container bg-dark-card bg-opacity-50 p-8 rounded-xl">
                <!-- Animated Icon -->
                <div class="flex justify-center mb-6">
                    <div class="relative">
                        <div class="w-16 h-16 bg-gradient-to-r from-neon-pink to-neon-purple rounded-full flex items-center justify-center animate-float">
                            <svg class="w-8 h-8 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"></path>
                            </svg>
                        </div>
                        <div class="absolute inset-0 w-16 h-16 bg-gradient-to-r from-neon-pink to-neon-purple rounded-full pulse-ring"></div>
                    </div>
                </div>
                
                <h2 class="text-3xl font-bold text-center mb-2 text-neon-pink neon-text">Verify Code</h2>
                <p class="text-center text-gray-400 mb-6 text-sm">
                    Enter the 6-digit verification code sent to your email
                </p>
                
                {% with messages = get_flashed_messages(with_categories=true) %}
                    {% if messages %}
                        {% for category, message in messages %}
                            <div class="mb-4 p-3 rounded-lg {% if category == 'danger' %}bg-red-600{% elif category == 'success' %}bg-green-600{% else %}bg-blue-600{% endif %} bg-opacity-20 border {% if category == 'danger' %}border-red-500{% elif category == 'success' %}border-green-500{% else %}border-blue-500{% endif %}">
                                {{ message }}
                            </div>
                        {% endfor %}
                    {% endif %}
                {% endwith %}
                
                <form method="POST" action="{{ url_for('auth.verify_otp') }}" id="otp-form" class="space-y-6">
                    {{ csrf_token() }}
                    
                    <div class="flex justify-center space-x-2">
                        <input type="text" maxlength="1" name="otp1" class="otp-input rounded-lg text-center text-white" pattern="[0-9]" required>
                        <input type="text" maxlength="1" name="otp2" class="otp-input rounded-lg text-center text-white" pattern="[0-9]" required>
                        <input type="text" maxlength="1" name="otp3" class="otp-input rounded-lg text-center text-white" pattern="[0-9]" required>
                        <input type="text" maxlength="1" name="otp4" class="otp-input rounded-lg text-center text-white" pattern="[0-9]" required>
                        <input type="text" maxlength="1" name="otp5" class="otp-input rounded-lg text-center text-white" pattern="[0-9]" required>
                        <input type="text" maxlength="1" name="otp6" class="otp-input rounded-lg text-center text-white" pattern="[0-9]" required>
                    </div>
                    
                    <!-- Hidden field to combine OTP -->
                    <input type="hidden" name="otp_code" id="otp_code">
                    
                    <button type="submit" 
                        class="w-full bg-gradient-to-r from-neon-pink to-neon-purple text-white py-3 rounded-lg font-semibold hover:shadow-neon-pink transition-all duration-300 btn-neon">
                        Verify Code
                    </button>
                    
                    <div class="text-center space-y-4">
                        <div class="text-sm text-gray-400">
                            Didn't receive the code?
                        </div>
                        <form method="POST" action="{{ url_for('auth.resend_otp') }}" class="inline">
                            {{ csrf_token() }}
                            <button type="submit" class="text-neon-cyan hover:text-neon-purple transition-colors font-semibold">
                                Resend Code
                            </button>
                        </form>
                    </div>
                </form>
                
                <div class="text-center mt-6">
                    <a href="{{ url_for('auth.forgot_password') }}" class="text-gray-400 hover:text-neon-cyan transition-colors">
                        ‚Üê Back to Email Entry
                    </a>
                </div>
            </div>
            
            <!-- Timer Display -->
            <div class="text-center mt-4">
                <div class="text-sm text-gray-500">
                    Code expires in: <span id="timer" class="text-neon-pink font-bold">05:00</span>
                </div>
            </div>
        </div>
    </div>

    <script>
        // OTP Input Navigation and Validation
        document.addEventListener('DOMContentLoaded', function() {
            const otpInputs = document.querySelectorAll('.otp-input');
            const otpForm = document.getElementById('otp-form');
            const hiddenOtpField = document.getElementById('otp_code');
            
            // Auto-focus and navigation
            otpInputs.forEach((input, index) => {
                input.addEventListener('input', function(e) {
                    // Only allow numbers
                    this.value = this.value.replace(/[^0-9]/g, '');
                    
                    // Move to next input if current is filled
                    if (this.value.length === 1 && index < otpInputs.length - 1) {
                        otpInputs[index + 1].focus();
                    }
                    
                    updateHiddenField();
                });
                
                input.addEventListener('keydown', function(e) {
                    // Move to previous input on backspace if current is empty
                    if (e.key === 'Backspace' && this.value === '' && index > 0) {
                        otpInputs[index - 1].focus();
                    }
                    
                    // Allow only numbers, backspace, delete, tab, and arrow keys
                    if (![8, 9, 27, 46, 37, 39].includes(e.keyCode) && 
                        (e.keyCode < 48 || e.keyCode > 57) && 
                        (e.keyCode < 96 || e.keyCode > 105)) {
                        e.preventDefault();
                    }
                });
                
                // Handle paste
                input.addEventListener('paste', function(e) {
                    e.preventDefault();
                    const paste = (e.clipboardData || window.clipboardData).getData('text');
                    const pasteData = paste.replace(/[^0-9]/g, '').slice(0, 6);
                    
                    pasteData.split('').forEach((char, i) => {
                        if (i < otpInputs.length) {
                            otpInputs[i].value = char;
                        }
                    });
                    
                    // Focus on next empty field or last field
                    const nextEmpty = Array.from(otpInputs).findIndex(input => input.value === '');
                    if (nextEmpty !== -1) {
                        otpInputs[nextEmpty].focus();
                    } else {
                        otpInputs[otpInputs.length - 1].focus();
                    }
                    
                    updateHiddenField();
                });
            });
            
            // Update hidden field with combined OTP
            function updateHiddenField() {
                const otpValue = Array.from(otpInputs).map(input => input.value).join('');
                hiddenOtpField.value = otpValue;
            }
            
            // Form submission validation
            otpForm.addEventListener('submit', function(e) {
                const otpValue = Array.from(otpInputs).map(input => input.value).join('');
                
                if (otpValue.length !== 6) {
                    e.preventDefault();
                    showError('Please enter all 6 digits');
                    return false;
                }
                
                if (!/^\d{6}$/.test(otpValue)) {
                    e.preventDefault();
                    showError('Please enter numbers only');
                    return false;
                }
                
                hiddenOtpField.value = otpValue;
            });
            
            // Focus first input on load
            otpInputs[0].focus();
            
            // Timer functionality
            startTimer();
        });
        
        // Error message display
        function showError(message) {
            const errorDiv = document.createElement('div');
            errorDiv.className = 'fixed top-4 right-4 bg-red-600 text-white px-4 py-2 rounded-lg shadow-lg z-50';
            errorDiv.textContent = message;
            document.body.appendChild(errorDiv);
            
            setTimeout(() => {
                if (document.body.contains(errorDiv)) {
                    document.body.removeChild(errorDiv);
                }
            }, 3000);
        }
        
        // Timer countdown
        function startTimer() {
            let timeLeft = 300; // 5 minutes in seconds
            const timerElement = document.getElementById('timer');
            
            const timer = setInterval(() => {
                const minutes = Math.floor(timeLeft / 60);
                const seconds = timeLeft % 60;
                
                timerElement.textContent = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
                
                if (timeLeft <= 0) {
                    clearInterval(timer);
                    timerElement.textContent = '00:00';
                    timerElement.className = 'text-red-500 font-bold';
                    showError('Verification code has expired. Please request a new one.');
                }
                
                timeLeft--;
            }, 1000);
        }
    </script>
</body>
</html>